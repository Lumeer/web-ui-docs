<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Lumeer Web UI documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">Lumeer Web UI documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search">
</div>
            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">







<ol class="breadcrumb">
  <li>Injectables</li>
  <li>TablesEffects</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/core/store/tables/tables.effects.ts</code>
        </p>



            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#addColumn$">addColumn$</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#createPart$">createPart$</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#createTable$">createTable$</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#destroyTable$">destroyTable$</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#hideColumn$">hideColumn$</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#indentRow$">indentRow$</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#initColumn$">initColumn$</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#moveCursor$">moveCursor$</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#moveRowDown$">moveRowDown$</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#moveRowUp$">moveRowUp$</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#outdentRow$">outdentRow$</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#removeColumn$">removeColumn$</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#removePart$">removePart$</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#resizeColumn$">resizeColumn$</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#showColumns$">showColumns$</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#splitColumn$">splitColumn$</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#switchParts$">switchParts$</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#syncLinkedRows$">syncLinkedRows$</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#syncPrimaryRows$">syncPrimaryRows$</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#createNewEmptyColumn">createNewEmptyColumn</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#createViewCursorFromTable">createViewCursorFromTable</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#getLatestAttributes">getLatestAttributes</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#getLatestTable">getLatestTable</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                                <span class="modifier">Public</span>
                        <code>constructor(actions$: Actions, store$: <a href="../interfaces/AppState.html">Store<AppState></a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="893" class="link-to-prism">src/app/core/store/tables/tables.effects.ts:893</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>actions$</td>
                                                  
                                                        <td>
                                                                    <code>Actions</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>store$</td>
                                                  
                                                        <td>
                                                                    <code><a href="../interfaces/AppState.html" target="_self" >Store&lt;AppState&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
        <h3 id="methods">
            Methods
        </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="createNewEmptyColumn"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Private</span>
                            createNewEmptyColumn
                            </b>
                            <a href="#createNewEmptyColumn"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>createNewEmptyColumn(table: <a href="../interfaces/TableModel.html">TableModel</a>, cursor: <a href="../undefineds/TableCursor.html">TableCursor</a>)</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="286" class="link-to-prism">src/app/core/store/tables/tables.effects.ts:286</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">

                            <div class="io-description">
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>table</td>
                                                        <td>
                                                                    <code><a href="../interfaces/TableModel.html" target="_self" >TableModel</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                                <tr>
                                                        <td>cursor</td>
                                                        <td>
                                                                    <code><a href="../miscellaneous/typealiases.html#TableCursor" target="_self" >TableCursor</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code><a href="../classes/TableCompoundColumn.html" target="_self" >Observable&lt;TableCompoundColumn&gt;</a></code>

                            </div>
                                <div class="io-description">
                                    
                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="createViewCursorFromTable"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Private</span>
                            createViewCursorFromTable
                            </b>
                            <a href="#createViewCursorFromTable"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>createViewCursorFromTable(table: <a href="../interfaces/TableModel.html">TableModel</a>, cursor: <a href="../undefineds/TableCursor.html">TableCursor</a>)</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="907" class="link-to-prism">src/app/core/store/tables/tables.effects.ts:907</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">

                            <div class="io-description">
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>table</td>
                                                        <td>
                                                                    <code><a href="../interfaces/TableModel.html" target="_self" >TableModel</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                                <tr>
                                                        <td>cursor</td>
                                                        <td>
                                                                    <code><a href="../miscellaneous/typealiases.html#TableCursor" target="_self" >TableCursor</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code><a href="../interfaces/ViewCursor.html" target="_self" >Observable&lt;ViewCursor&gt;</a></code>

                            </div>
                                <div class="io-description">
                                    
                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="getLatestAttributes"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Private</span>
                            getLatestAttributes
                            </b>
                            <a href="#getLatestAttributes"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>getLatestAttributes(part: <a href="../interfaces/TablePart.html">TablePart</a>)</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="304" class="link-to-prism">src/app/core/store/tables/tables.effects.ts:304</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">

                            <div class="io-description">
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>part</td>
                                                        <td>
                                                                    <code><a href="../interfaces/TablePart.html" target="_self" >TablePart</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code><a href="../interfaces/AttributeModel.html" target="_self" >Observable&lt;AttributeModel[]&gt;</a></code>

                            </div>
                                <div class="io-description">
                                    
                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="getLatestTable"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Private</span>
                            getLatestTable
                            </b>
                            <a href="#getLatestTable"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>getLatestTable(action: A)</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="897" class="link-to-prism">src/app/core/store/tables/tables.effects.ts:897</a></div>
                            </td>
                        </tr>

                        <tr>
                            <td class="col-md-4">
                                <b>Type parameters :</b>
                                <ul class="type-parameters">
                                        <li>A</li>
                                </ul>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">

                            <div class="io-description">
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>action</td>
                                                        <td>
                                                                    <code>A</code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code>Observable&lt;literal type&gt;</code>

                            </div>
                                <div class="io-description">
                                    
                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
        <h3 id="inputs">
            Properties
        </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="addColumn$"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            addColumn$
                            </b>
                            <a href="#addColumn$"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span><code>addColumn$:     <code>Observable&lt;Action&gt;</code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>Observable&lt;Action&gt;</code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>this.actions$.pipe(
    ofType&lt;TablesAction.AddColumn&gt;(TablesActionType.ADD_COLUMN),
    mergeMap(action &#x3D;&gt; this.getLatestTable(action)),
    mergeMap(({action, table}) &#x3D;&gt;
      this.createNewEmptyColumn(table, action.payload.cursor).pipe(
        map(
          column &#x3D;&gt;
            new TablesAction.ReplaceColumns({
              cursor: action.payload.cursor,
              deleteCount: 0,
              columns: [column],
            })
        )
      )
    )
  )</code>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Decorators : </i><code>Effect</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="269" class="link-to-prism">src/app/core/store/tables/tables.effects.ts:269</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="createPart$"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            createPart$
                            </b>
                            <a href="#createPart$"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span><code>createPart$:     <code>Observable&lt;Action&gt;</code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>Observable&lt;Action&gt;</code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>this.actions$.pipe(
    ofType&lt;TablesAction.CreatePart&gt;(TablesActionType.CREATE_PART),
    mergeMap(action &#x3D;&gt;
      this.store$.select(selectTableById(action.payload.tableId)).pipe(
        first(),
        filter(table &#x3D;&gt; !!table),
        map(table &#x3D;&gt; ({action, table}))
      )
    ),
    mergeMap(item &#x3D;&gt;
      this.store$.select(selectLinkTypeById(item.action.payload.linkTypeId)).pipe(
        first(),
        map(linkType &#x3D;&gt; ({...item, linkType}))
      )
    ),
    mergeMap(item &#x3D;&gt; {
      const parts &#x3D; item.table.parts;
      const lastPart &#x3D; parts[parts.length - 1];

      const collectionId &#x3D; LinkTypeHelper.getOtherCollectionId(item.linkType, lastPart.collectionId);
      return this.store$.select(selectCollectionById(collectionId)).pipe(
        first(),
        map(collection &#x3D;&gt; ({...item, collection}))
      );
    }),
    mergeMap(({action, table, linkType, collection}) &#x3D;&gt; {
      const lastPartIndex &#x3D; table.parts.length - 1;
      const linkTypePart &#x3D; createLinkPart(linkType, lastPartIndex + 1, action.payload.config);
      const collectionPart &#x3D; createCollectionPart(
        collection,
        lastPartIndex + 2,
        action.payload.last,
        action.payload.config
      );

      return [
        new TablesAction.RemoveEmptyColumns({
          cursor: {tableId: table.id, partIndex: lastPartIndex},
        }),
        new TablesAction.AddPart({
          tableId: table.id,
          parts: [linkTypePart, collectionPart],
        }),
        // TODO get data only in guards
        new DocumentsAction.Get({
          query: {
            collectionIds: [collection.id],
          },
        }),
        new LinkInstancesAction.Get({
          query: {
            linkTypeIds: [linkType.id],
          },
        }),
      ];
    })
  )</code>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Decorators : </i><code>Effect</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="163" class="link-to-prism">src/app/core/store/tables/tables.effects.ts:163</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="createTable$"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            createTable$
                            </b>
                            <a href="#createTable$"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span><code>createTable$:     <code>Observable&lt;Action&gt;</code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>Observable&lt;Action&gt;</code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>this.actions$.pipe(
    ofType&lt;TablesAction.CreateTable&gt;(TablesActionType.CREATE_TABLE),
    filter(action &#x3D;&gt; {
      const {query} &#x3D; action.payload;
      return query &amp;&amp; query.collectionIds &amp;&amp; query.collectionIds.length &#x3D;&#x3D;&#x3D; 1;
    }),
    withLatestFrom(
      this.store$.select(selectCollectionsLoaded).pipe(
        filter(loaded &#x3D;&gt; loaded),
        mergeMap(() &#x3D;&gt; this.store$.select(selectAllCollections))
      )
    ),
    flatMap(([action, collections]) &#x3D;&gt; {
      const {config, query} &#x3D; action.payload;

      const collection &#x3D; collections.find(col &#x3D;&gt; col.id &#x3D;&#x3D;&#x3D; query.collectionIds[0]);
      const last &#x3D; !query.linkTypeIds || query.linkTypeIds.length &#x3D;&#x3D;&#x3D; 0;
      const part &#x3D; createCollectionPart(collection, 0, last, config);

      const createTableAction: Action &#x3D; new TablesAction.AddTable({
        table: {
          id: action.payload.tableId,
          parts: [part],
          config: config || {
            parts: convertTablePartsToConfig([part]),
            rows: [createEmptyTableRow()],
          },
        },
      });

      const createPartActions: Action[] &#x3D; query.linkTypeIds.map(
        (linkTypeId, index) &#x3D;&gt;
          new TablesAction.CreatePart({
            tableId: action.payload.tableId,
            linkTypeId,
            last: index &#x3D;&#x3D;&#x3D; query.linkTypeIds.length - 1,
            config,
          })
      );

      return [createTableAction].concat(createPartActions);
    })
  )</code>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Decorators : </i><code>Effect</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="91" class="link-to-prism">src/app/core/store/tables/tables.effects.ts:91</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="destroyTable$"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            destroyTable$
                            </b>
                            <a href="#destroyTable$"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span><code>destroyTable$:     <code>Observable&lt;Action&gt;</code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>Observable&lt;Action&gt;</code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>this.actions$.pipe(
    ofType&lt;TablesAction.DestroyTable&gt;(TablesActionType.DESTROY_TABLE),
    mergeMap(action &#x3D;&gt;
      combineLatest(
        this.store$.select(selectTableById(action.payload.tableId)),
        this.store$.select(selectTableCursor)
      ).pipe(first())
    ),
    filter(([table]) &#x3D;&gt; !!table),
    mergeMap(([table, tableCursor]) &#x3D;&gt; {
      if (tableCursor &amp;&amp; tableCursor.tableId &#x3D;&#x3D;&#x3D; table.id) {
        return this.createViewCursorFromTable(table, tableCursor).pipe(map(viewCursor &#x3D;&gt; ({table, viewCursor})));
      }
      return of({table, viewCursor: null});
    }),
    flatMap(({table, viewCursor}) &#x3D;&gt; {
      const actions: Action[] &#x3D; [new TablesAction.RemoveTable({tableId: table.id})];

      if (table.id &#x3D;&#x3D;&#x3D; DEFAULT_TABLE_ID) {
        actions.push(new ViewsAction.SetCursor({cursor: viewCursor}));
      }

      return actions;
    })
  )</code>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Decorators : </i><code>Effect</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="136" class="link-to-prism">src/app/core/store/tables/tables.effects.ts:136</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="hideColumn$"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            hideColumn$
                            </b>
                            <a href="#hideColumn$"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span><code>hideColumn$:     <code>Observable&lt;Action&gt;</code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>Observable&lt;Action&gt;</code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>this.actions$.pipe(
    ofType&lt;TablesAction.HideColumn&gt;(TablesActionType.HIDE_COLUMN),
    mergeMap(action &#x3D;&gt; this.getLatestTable(action)),
    mergeMap(({action, table}) &#x3D;&gt; {
      const {cursor} &#x3D; action.payload;
      const part: TablePart &#x3D; table.parts[cursor.partIndex];
      const {parentPath, columnIndex} &#x3D; splitColumnPath(cursor.columnPath);

      const column &#x3D; findTableColumn(part.columns, cursor.columnPath) as TableCompoundColumn;

      const pathBefore &#x3D; parentPath.concat(columnIndex - 1);
      const columnBefore &#x3D; columnIndex &gt; 0 ? findTableColumn(part.columns, pathBefore) : null;
      const hiddenBefore: boolean &#x3D; columnBefore &amp;&amp; columnBefore.type &#x3D;&#x3D;&#x3D; TableColumnType.HIDDEN;

      const columnAfter &#x3D; findTableColumn(part.columns, parentPath.concat(columnIndex + 1));
      const hiddenAfter: boolean &#x3D; columnAfter &amp;&amp; columnAfter.type &#x3D;&#x3D;&#x3D; TableColumnType.HIDDEN;

      const actions: Action[] &#x3D; [];

      if (hiddenBefore &amp;&amp; hiddenAfter) {
        const mergedColumn &#x3D; mergeHiddenColumns(columnBefore as TableHiddenColumn, columnAfter as TableHiddenColumn);
        actions.push(
          new TablesAction.ReplaceColumns({
            cursor: {...cursor, columnPath: pathBefore},
            deleteCount: 3,
            columns: [extendHiddenColumn(mergedColumn, column.parent.attributeId)],
          })
        );
      }
      if (hiddenBefore &amp;&amp; !hiddenAfter) {
        actions.push(
          new TablesAction.ReplaceColumns({
            cursor: {...cursor, columnPath: pathBefore},
            deleteCount: 2,
            columns: [extendHiddenColumn(columnBefore as TableHiddenColumn, column.parent.attributeId)],
          })
        );
      }
      if (!hiddenBefore &amp;&amp; hiddenAfter) {
        actions.push(
          new TablesAction.ReplaceColumns({
            cursor,
            deleteCount: 2,
            columns: [extendHiddenColumn(columnAfter as TableHiddenColumn, column.parent.attributeId)],
          })
        );
      }
      if (!hiddenBefore &amp;&amp; !hiddenAfter) {
        actions.push(
          new TablesAction.ReplaceColumns({
            cursor,
            deleteCount: 1,
            columns: [new TableHiddenColumn([column.parent.attributeId])],
          })
        );
      }

      return actions;
    })
  )</code>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Decorators : </i><code>Effect</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="362" class="link-to-prism">src/app/core/store/tables/tables.effects.ts:362</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="indentRow$"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            indentRow$
                            </b>
                            <a href="#indentRow$"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span><code>indentRow$:     <code>Observable&lt;Action&gt;</code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>Observable&lt;Action&gt;</code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>this.actions$.pipe(
    ofType&lt;TablesAction.IndentRow&gt;(TablesActionType.INDENT_ROW),
    map(action &#x3D;&gt; action.payload.cursor),
    filter(cursor &#x3D;&gt; cursor.partIndex &#x3D;&#x3D;&#x3D; 0 &amp;&amp; cursor.rowPath[0] &gt; 0),
    withLatestFrom(this.store$.pipe(select(selectDocumentsDictionary))),
    mergeMap(([cursor, documentsMap]) &#x3D;&gt;
      this.store$.pipe(
        select(selectTableRowsWithHierarchyLevels(cursor.tableId)),
        first(),
        map(rows &#x3D;&gt; {
          const rowIndex &#x3D; cursor.rowPath[0];
          const {row, level} &#x3D; rows[rowIndex];
          const {row: newParentRow &#x3D; undefined} &#x3D;
            rows
              .slice(0, cursor.rowPath[0])
              .reverse()
              .find(hierarchyRow &#x3D;&gt; hierarchyRow.level &#x3D;&#x3D;&#x3D; level) || {};
          const parentDocumentId &#x3D; newParentRow &amp;&amp; newParentRow.documentId;

          if (row.documentId) {
            const {collectionId, id: documentId} &#x3D; documentsMap[row.documentId];
            return new DocumentsAction.PatchMetaData({
              collectionId,
              documentId,
              metaData: {parentId: parentDocumentId},
            });
          } else {
            const updatedRow: TableConfigRow &#x3D; {...row, parentDocumentId};
            return new TablesAction.ReplaceRows({cursor, deleteCount: 1, rows: [updatedRow]});
          }
        })
      )
    )
  )</code>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Decorators : </i><code>Effect</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="652" class="link-to-prism">src/app/core/store/tables/tables.effects.ts:652</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="initColumn$"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            initColumn$
                            </b>
                            <a href="#initColumn$"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span><code>initColumn$:     <code>Observable&lt;Action&gt;</code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>Observable&lt;Action&gt;</code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>this.actions$.pipe(
    ofType&lt;TablesAction.InitColumn&gt;(TablesActionType.INIT_COLUMN),
    mergeMap(action &#x3D;&gt; this.getLatestTable(action)),
    mergeMap(({action, table}) &#x3D;&gt; {
      const part: TablePart &#x3D; table.parts[action.payload.cursor.partIndex];
      const column &#x3D; findTableColumn(part.columns, action.payload.cursor.columnPath) as TableCompoundColumn;
      const parent &#x3D; {...column.parent, attributeId: action.payload.attributeId};
      const columns &#x3D; [{...column, parent}];

      const {cursor} &#x3D; action.payload;
      const actions: Action[] &#x3D; [
        new TablesAction.ReplaceColumns({
          cursor,
          deleteCount: 1,
          columns,
        }),
      ];

      if (cursor.columnPath.length &#x3D;&#x3D;&#x3D; 1) {
        actions.push(new TablesAction.AddColumn({cursor: {...cursor, columnPath: [cursor.columnPath[0] + 1]}}));
      }

      return actions;
    })
  )</code>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Decorators : </i><code>Effect</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="507" class="link-to-prism">src/app/core/store/tables/tables.effects.ts:507</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="moveCursor$"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            moveCursor$
                            </b>
                            <a href="#moveCursor$"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span><code>moveCursor$:     <code>Observable&lt;Action&gt;</code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>Observable&lt;Action&gt;</code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>this.actions$.pipe(
    ofType&lt;TablesAction.MoveCursor&gt;(TablesActionType.MOVE_CURSOR),
    withLatestFrom(this.store$.select(selectTableCursor).pipe(filter(cursor &#x3D;&gt; !!cursor))),
    concatMap(([action, cursor]) &#x3D;&gt;
      this.store$.select(selectTableById(cursor.tableId)).pipe(
        first(),
        map(table &#x3D;&gt; ({action, cursor, table}))
      )
    ),
    mergeMap(({action, cursor, table}) &#x3D;&gt; {
      try {
        const nextCursor &#x3D; moveTableCursor(table, cursor, action.payload.direction);
        return [new TablesAction.SetCursor({cursor: nextCursor})];
      } catch (error) {
        return [];
      }
    })
  )</code>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Decorators : </i><code>Effect</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="876" class="link-to-prism">src/app/core/store/tables/tables.effects.ts:876</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="moveRowDown$"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            moveRowDown$
                            </b>
                            <a href="#moveRowDown$"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span><code>moveRowDown$:     <code>Observable&lt;Action&gt;</code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>Observable&lt;Action&gt;</code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>this.actions$.pipe(
    ofType&lt;TablesAction.MoveRowDown&gt;(TablesActionType.MOVE_ROW_DOWN),
    mergeMap(action &#x3D;&gt; {
      const {cursor} &#x3D; action.payload;
      const {parentPath, rowIndex} &#x3D; splitRowPath(cursor.rowPath);

      return combineLatest(
        this.store$.pipe(select(selectTableRows(cursor.tableId))),
        this.store$.pipe(select(selectTableRowsWithHierarchyLevels(cursor.tableId))),
        this.store$.pipe(select(selectDocumentsDictionary))
      ).pipe(
        first(),
        mergeMap(([rows, hierarchyRows, documentsMap]) &#x3D;&gt; {
          if (cursor.partIndex &gt; 0) {
            const row &#x3D; findTableRow(rows, cursor.rowPath);
            const nextLinkedCursor: TableBodyCursor &#x3D; {...cursor, rowPath: parentPath.concat(rowIndex + 1)};
            const nextLinkedRow &#x3D; findTableRow(rows, nextLinkedCursor.rowPath);
            if (!nextLinkedRow) {
              return [];
            }

            const targetLinkedCursor: TableBodyCursor &#x3D; {...cursor, rowPath: parentPath.concat(rowIndex + 2)};

            return [
              new TablesAction.ReplaceRows({cursor: targetLinkedCursor, rows: [row], deleteCount: 0}),
              new TablesAction.RemoveRow({cursor}),
            ];
          }

          const sourceRow &#x3D; hierarchyRows[cursor.rowPath[0]];
          const document &#x3D; documentsMap[sourceRow &amp;&amp; sourceRow.row.documentId];
          const parentId &#x3D;
            (document &amp;&amp; document.metaData &amp;&amp; document.metaData.parentId) ||
            (sourceRow &amp;&amp; sourceRow.row.parentDocumentId) ||
            null;

          const nextRow &#x3D; hierarchyRows.slice(rowIndex + 1).find(row &#x3D;&gt; row.level &lt;&#x3D; sourceRow.level);
          if (!nextRow) {
            return [];
          }

          const targetRowIndex &#x3D; hierarchyRows.indexOf(nextRow) + 1;
          const targetRow &#x3D; hierarchyRows[targetRowIndex];
          const targetCursor: TableBodyCursor &#x3D; {...cursor, rowPath: [targetRowIndex]};
          const targetDocument &#x3D; documentsMap[targetRow &amp;&amp; targetRow.row.documentId];
          const targetParentId &#x3D;
            (targetDocument &amp;&amp; targetDocument.metaData &amp;&amp; targetDocument.metaData.parentId) ||
            (targetRow &amp;&amp; targetRow.row.parentDocumentId) ||
            null;

          const deleteCount &#x3D; targetRowIndex - rowIndex - 1;
          const childRows &#x3D; rows.slice(rowIndex + 1, rowIndex + deleteCount);

          const actions: Action[] &#x3D; [
            new TablesAction.ReplaceRows({cursor: targetCursor, rows: [sourceRow.row, ...childRows], deleteCount: 0}),
            new TablesAction.ReplaceRows({cursor, rows: [], deleteCount}),
          ];

          if (parentId !&#x3D;&#x3D; targetParentId) {
            if (sourceRow.row.documentId) {
              return [
                new DocumentsAction.PatchMetaData({
                  collectionId: document.collectionId,
                  documentId: document.id,
                  metaData: {parentId: targetParentId},
                  onSuccess: () &#x3D;&gt; actions.forEach(a &#x3D;&gt; this.store$.dispatch(a)),
                }),
              ];
            } else {
              return [
                new TablesAction.ReplaceRows({
                  cursor: targetCursor,
                  rows: [{...sourceRow.row, parentDocumentId: targetParentId}, ...childRows],
                  deleteCount: 0,
                }),
                new TablesAction.ReplaceRows({cursor, rows: [], deleteCount}),
              ];
            }
          }

          return actions;
        })
      );
    })
  )</code>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Decorators : </i><code>Effect</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="789" class="link-to-prism">src/app/core/store/tables/tables.effects.ts:789</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="moveRowUp$"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            moveRowUp$
                            </b>
                            <a href="#moveRowUp$"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span><code>moveRowUp$:     <code>Observable&lt;Action&gt;</code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>Observable&lt;Action&gt;</code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>this.actions$.pipe(
    ofType&lt;TablesAction.MoveRowUp&gt;(TablesActionType.MOVE_ROW_UP),
    mergeMap(action &#x3D;&gt; {
      const {cursor} &#x3D; action.payload;
      const {parentPath, rowIndex} &#x3D; splitRowPath(cursor.rowPath);
      if (rowIndex &#x3D;&#x3D;&#x3D; 0) {
        return [];
      }

      return combineLatest(
        this.store$.pipe(select(selectTableRows(cursor.tableId))),
        this.store$.pipe(select(selectDocumentsDictionary))
      ).pipe(
        first(),
        mergeMap(([rows, documentsMap]) &#x3D;&gt; {
          const row &#x3D; findTableRow(rows, cursor.rowPath);
          const document &#x3D; documentsMap[row &amp;&amp; row.documentId];
          const parentId &#x3D;
            (document &amp;&amp; document.metaData &amp;&amp; document.metaData.parentId) || (row &amp;&amp; row.parentDocumentId) || null;

          const previousCursor: TableBodyCursor &#x3D; {...cursor, rowPath: parentPath.concat(rowIndex - 1)};
          const previousRow &#x3D; findTableRow(rows, previousCursor.rowPath);
          const previousDocument &#x3D; documentsMap[previousRow &amp;&amp; previousRow.documentId];
          const previousParentId &#x3D;
            (previousDocument &amp;&amp; previousDocument.metaData &amp;&amp; previousDocument.metaData.parentId) ||
            (previousRow &amp;&amp; previousRow.parentDocumentId) ||
            null;

          const actions: Action[] &#x3D; [
            new TablesAction.RemoveRow({cursor}),
            new TablesAction.ReplaceRows({cursor: previousCursor, rows: [row], deleteCount: 0}),
          ];

          if (cursor.partIndex &#x3D;&#x3D;&#x3D; 0 &amp;&amp; parentId !&#x3D;&#x3D; previousParentId) {
            if (row.documentId) {
              return [
                new DocumentsAction.PatchMetaData({
                  collectionId: document.collectionId,
                  documentId: document.id,
                  metaData: {parentId: previousParentId},
                  onSuccess: () &#x3D;&gt; actions.forEach(a &#x3D;&gt; this.store$.dispatch(a)),
                }),
              ];
            } else {
              return [
                new TablesAction.RemoveRow({cursor}),
                new TablesAction.ReplaceRows({
                  cursor: previousCursor,
                  rows: [{...row, parentDocumentId: previousParentId}],
                  deleteCount: 0,
                }),
              ];
            }
          }

          return actions;
        })
      );
    })
  )</code>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Decorators : </i><code>Effect</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="727" class="link-to-prism">src/app/core/store/tables/tables.effects.ts:727</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="outdentRow$"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            outdentRow$
                            </b>
                            <a href="#outdentRow$"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span><code>outdentRow$:     <code>Observable&lt;Action&gt;</code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>Observable&lt;Action&gt;</code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>this.actions$.pipe(
    ofType&lt;TablesAction.OutdentRow&gt;(TablesActionType.OUTDENT_ROW),
    map(action &#x3D;&gt; action.payload.cursor),
    filter(cursor &#x3D;&gt; cursor.partIndex &#x3D;&#x3D;&#x3D; 0),
    withLatestFrom(this.store$.pipe(select(selectDocumentsDictionary))),
    mergeMap(([cursor, documentsMap]) &#x3D;&gt;
      this.store$.pipe(
        select(selectTableRowsWithHierarchyLevels(cursor.tableId)),
        first(),
        map(rows &#x3D;&gt; {
          const rowIndex &#x3D; cursor.rowPath[0];
          const {row, level} &#x3D; rows[rowIndex];
          const {row: previousParentRow &#x3D; undefined} &#x3D;
            rows
              .slice(0, cursor.rowPath[0])
              .reverse()
              .find(hierarchyRow &#x3D;&gt; hierarchyRow.level &#x3D;&#x3D;&#x3D; level - 1) || {};
          const previousParentDocument &#x3D; documentsMap[previousParentRow &amp;&amp; previousParentRow.documentId];
          const parentDocumentId &#x3D;
            (previousParentDocument &amp;&amp; previousParentDocument.metaData &amp;&amp; previousParentDocument.metaData.parentId) ||
            null;

          if (row.documentId) {
            const {collectionId, id: documentId} &#x3D; documentsMap[row.documentId];
            return new DocumentsAction.PatchMetaData({
              collectionId,
              documentId,
              metaData: {parentId: parentDocumentId},
            });
          } else {
            const updatedRow: TableConfigRow &#x3D; {...row, parentDocumentId};
            return new TablesAction.ReplaceRows({cursor, deleteCount: 1, rows: [updatedRow]});
          }
        })
      )
    )
  )</code>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Decorators : </i><code>Effect</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="688" class="link-to-prism">src/app/core/store/tables/tables.effects.ts:688</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="removeColumn$"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            removeColumn$
                            </b>
                            <a href="#removeColumn$"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span><code>removeColumn$:     <code>Observable&lt;Action&gt;</code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>Observable&lt;Action&gt;</code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>this.actions$.pipe(
    ofType&lt;TablesAction.RemoveColumn&gt;(TablesActionType.REMOVE_COLUMN),
    mergeMap(action &#x3D;&gt;
      this.store$.select(selectTableById(action.payload.cursor.tableId)).pipe(
        first(),
        map(table &#x3D;&gt; ({action, table}))
      )
    ),
    flatMap(({action, table}) &#x3D;&gt; {
      const {cursor} &#x3D; action.payload;
      const part: TablePart &#x3D; table.parts[cursor.partIndex];
      const column &#x3D; findTableColumn(part.columns, cursor.columnPath);
      const attributeId &#x3D; getAttributeIdFromColumn(column);

      return [
        new TablesAction.ReplaceColumns({cursor, deleteCount: 1}),
        new CollectionsAction.RemoveAttribute({collectionId: part.collectionId, attributeId}),
      ];
    })
  )</code>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Decorators : </i><code>Effect</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="467" class="link-to-prism">src/app/core/store/tables/tables.effects.ts:467</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="removePart$"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            removePart$
                            </b>
                            <a href="#removePart$"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span><code>removePart$:     <code>Observable&lt;Action&gt;</code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>Observable&lt;Action&gt;</code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>this.actions$.pipe(
    ofType&lt;TablesAction.RemovePart&gt;(TablesActionType.REMOVE_PART),
    mergeMap(action &#x3D;&gt; this.getLatestTable(action)),
    withLatestFrom(this.store$.select(selectQuery)),
    map(([{action, table}, query]) &#x3D;&gt; {
      const linkTypeIds &#x3D; table.parts
        .slice(0, action.payload.cursor.partIndex)
        .reduce((ids, part) &#x3D;&gt; (part.linkTypeId ? ids.concat(part.linkTypeId) : ids), []);
      const newQuery: QueryModel &#x3D; {...query, linkTypeIds};

      return new RouterAction.Go({
        path: [],
        queryParams: {
          query: QueryConverter.toString(newQuery),
        },
        extras: {
          queryParamsHandling: &#x27;merge&#x27;,
        },
      });
    })
  )</code>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Decorators : </i><code>Effect</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="246" class="link-to-prism">src/app/core/store/tables/tables.effects.ts:246</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="resizeColumn$"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            resizeColumn$
                            </b>
                            <a href="#resizeColumn$"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span><code>resizeColumn$:     <code>Observable&lt;Action&gt;</code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>Observable&lt;Action&gt;</code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>this.actions$.pipe(
    ofType&lt;TablesAction.ResizeColumn&gt;(TablesActionType.RESIZE_COLUMN),
    mergeMap(action &#x3D;&gt; this.getLatestTable(action)),
    map(({action, table}) &#x3D;&gt; {
      const {cursor} &#x3D; action.payload;
      const part: TablePart &#x3D; table.parts[cursor.partIndex];
      const column &#x3D; findTableColumn(part.columns, cursor.columnPath) as TableCompoundColumn;
      const resizedColumn &#x3D; resizeLastColumnChild(column, action.payload.delta);

      return new TablesAction.ReplaceColumns({
        cursor,
        deleteCount: 1,
        columns: [resizedColumn],
      });
    })
  )</code>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Decorators : </i><code>Effect</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="489" class="link-to-prism">src/app/core/store/tables/tables.effects.ts:489</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="showColumns$"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            showColumns$
                            </b>
                            <a href="#showColumns$"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span><code>showColumns$:     <code>Observable&lt;Action&gt;</code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>Observable&lt;Action&gt;</code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>this.actions$.pipe(
    ofType&lt;TablesAction.ShowColumns&gt;(TablesActionType.SHOW_COLUMNS),
    mergeMap(action &#x3D;&gt; this.getLatestTable(action)),
    map(({action, table}) &#x3D;&gt; {
      const part: TablePart &#x3D; table.parts[action.payload.cursor.partIndex];
      return {action, part};
    }),
    mergeMap(({action, part}) &#x3D;&gt; {
      if (part.collectionId) {
        return this.store$.select(selectCollectionById(part.collectionId)).pipe(
          first(),
          map(collection &#x3D;&gt; ({action, part, attributes: collection.attributes}))
        );
      }
      if (part.linkTypeId) {
        return this.store$.select(selectLinkTypeById(part.linkTypeId)).pipe(
          first(),
          map(collection &#x3D;&gt; ({action, part, attributes: collection.attributes}))
        );
      }
    }),
    map(({action, part, attributes}) &#x3D;&gt; {
      const {cursor, attributeIds} &#x3D; action.payload;

      const hiddenColumn &#x3D; findTableColumn(part.columns, cursor.columnPath) as TableHiddenColumn;

      const columns &#x3D; createTableColumnsBySiblingAttributeIds(attributes, attributeIds);

      const hiddenAttributeIds &#x3D; getArrayDifference(hiddenColumn.attributeIds, attributeIds);
      if (hiddenAttributeIds.length &gt; 0) {
        const updatedHiddenColumn: TableHiddenColumn &#x3D; {...hiddenColumn, attributeIds: hiddenAttributeIds};
        columns.push(updatedHiddenColumn);
      }

      return new TablesAction.ReplaceColumns({
        cursor: action.payload.cursor,
        deleteCount: 1,
        columns,
      });
    })
  )</code>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Decorators : </i><code>Effect</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="424" class="link-to-prism">src/app/core/store/tables/tables.effects.ts:424</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="splitColumn$"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            splitColumn$
                            </b>
                            <a href="#splitColumn$"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span><code>splitColumn$:     <code>Observable&lt;Action&gt;</code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>Observable&lt;Action&gt;</code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>this.actions$.pipe(
    ofType&lt;TablesAction.SplitColumn&gt;(TablesActionType.SPLIT_COLUMN),
    mergeMap(action &#x3D;&gt;
      this.store$.select(selectTableById(action.payload.cursor.tableId)).pipe(
        first(),
        mergeMap(table &#x3D;&gt; {
          const part &#x3D; table.parts[action.payload.cursor.partIndex];
          return this.store$.select(selectCollectionById(part.collectionId)).pipe(
            // TODO linktype as well
            first(),
            map(collection &#x3D;&gt; ({action, part, collection}))
          );
        })
      )
    ),
    flatMap(({action, part, collection}) &#x3D;&gt; {
      const childNames &#x3D; [&#x27;A&#x27;, &#x27;B&#x27;];

      const {cursor} &#x3D; action.payload;
      const column &#x3D; findTableColumn(part.columns, cursor.columnPath) as TableCompoundColumn;

      const oldAttribute &#x3D; collection.attributes.find(attribute &#x3D;&gt; attribute.id &#x3D;&#x3D;&#x3D; column.parent.attributeId);

      const replaceColumnAction &#x3D; createReplaceColumnAction(action, column, childNames);
      const parentAttributeAction &#x3D; createParentAttributeAction(collection, oldAttribute, replaceColumnAction);
      const secondChildAttributeAction &#x3D; createSecondChildAttributeAction(
        collection,
        oldAttribute,
        childNames[1],
        parentAttributeAction
      );
      const firstChildAttributeAction &#x3D; createFirstChildAttributeAction(
        collection,
        oldAttribute,
        childNames[0],
        secondChildAttributeAction
      );

      return [firstChildAttributeAction, new TablesAction.SetCursor({cursor: null})];
    })
  )</code>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Decorators : </i><code>Effect</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="319" class="link-to-prism">src/app/core/store/tables/tables.effects.ts:319</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="switchParts$"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            switchParts$
                            </b>
                            <a href="#switchParts$"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span><code>switchParts$:     <code>Observable&lt;Action&gt;</code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>Observable&lt;Action&gt;</code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>this.actions$.pipe(
    ofType&lt;TablesAction.SwitchParts&gt;(TablesActionType.SWITCH_PARTS),
    mergeMap(action &#x3D;&gt; this.getLatestTable(action)),
    filter(({action, table}) &#x3D;&gt; table.parts.length &#x3D;&#x3D;&#x3D; 3),
    withLatestFrom(this.store$.select(selectQuery)),
    map(([{action, table}, query]) &#x3D;&gt; {
      const linkTypeIds &#x3D; [table.parts[1].linkTypeId];
      const collectionIds &#x3D; [table.parts[2].collectionId];

      const newQuery: QueryModel &#x3D; {...query, collectionIds, linkTypeIds};

      return new RouterAction.Go({
        path: [],
        queryParams: {
          query: QueryConverter.toString(newQuery),
        },
        extras: {
          queryParamsHandling: &#x27;merge&#x27;,
        },
      });
    })
  )</code>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Decorators : </i><code>Effect</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="222" class="link-to-prism">src/app/core/store/tables/tables.effects.ts:222</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="syncLinkedRows$"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            syncLinkedRows$
                            </b>
                            <a href="#syncLinkedRows$"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span><code>syncLinkedRows$:     <code>Observable&lt;Action&gt;</code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>Observable&lt;Action&gt;</code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>this.actions$.pipe(
    ofType&lt;TablesAction.SyncLinkedRows&gt;(TablesActionType.SYNC_LINKED_ROWS),
    mergeMap(action &#x3D;&gt;
      combineLatest(
        this.store$.pipe(select(selectTablePart(action.payload.cursor))),
        this.store$.pipe(select(selectTableRow(action.payload.cursor)))
      ).pipe(
        first(),
        filter(([part, row]) &#x3D;&gt; !!part &amp;&amp; !!row),
        mergeMap(([part, row]) &#x3D;&gt; {
          const linkedRows &#x3D; row.linkedRows || [];
          return this.store$.pipe(
            select(selectLinkInstancesByTypeAndDocuments(part.linkTypeId, [row.documentId])),
            first(),
            mergeMap(linkInstances &#x3D;&gt; {
              const documentIds &#x3D; linkInstances.reduce((ids, linkInstance) &#x3D;&gt; {
                const documentId &#x3D; getOtherDocumentIdFromLinkInstance(linkInstance, row.documentId);
                return ids.includes(documentId) ? ids : ids.concat(documentId);
              }, []);
              return this.store$.pipe(
                select(selectDocumentsByIds(documentIds)),
                first(),
                mergeMap(documents &#x3D;&gt; {
                  const createdDocuments &#x3D; filterNewlyCreatedDocuments(linkedRows, documents);
                  const unknownDocuments &#x3D; filterUnknownDocuments(linkedRows, documents);

                  const actions: Action[] &#x3D; [];

                  if (createdDocuments.length &gt; 0) {
                    actions.push(
                      new TablesAction.InitRows({
                        cursor: action.payload.cursor,
                        documents: createdDocuments,
                        linkInstances,
                      })
                    );
                  }

                  if (
                    unknownDocuments.length &gt; 0 &amp;&amp;
                    unknownDocuments.some(document &#x3D;&gt; !!findLinkInstanceByDocumentId(linkInstances, document.id))
                  ) {
                    actions.push(
                      new TablesAction.AddLinkedRows({
                        cursor: action.payload.cursor,
                        linkedRows: unknownDocuments.reduce((rows, document) &#x3D;&gt; {
                          const linkInstance &#x3D; findLinkInstanceByDocumentId(linkInstances, document.id);
                          return linkInstance ? rows.concat(createTableRow(document, linkInstance)) : rows;
                        }, []),
                        append: true,
                      })
                    );
                  }

                  return actions;
                })
              );
            })
          );
        })
      )
    )
  )</code>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Decorators : </i><code>Effect</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="587" class="link-to-prism">src/app/core/store/tables/tables.effects.ts:587</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="syncPrimaryRows$"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            syncPrimaryRows$
                            </b>
                            <a href="#syncPrimaryRows$"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span><code>syncPrimaryRows$:     <code>Observable&lt;Action&gt;</code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>Observable&lt;Action&gt;</code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>this.actions$.pipe(
    ofType&lt;TablesAction.SyncPrimaryRows&gt;(TablesActionType.SYNC_PRIMARY_ROWS),
    debounceTime(100), // otherwise unwanted parallel syncing occurs
    switchMap(action &#x3D;&gt;
      combineLatest(
        this.store$.pipe(select(selectTableRows(action.payload.cursor.tableId))),
        this.store$.pipe(select(selectDocumentsByCustomQuery(action.payload.query, false, true))), // TODO maybe remove links from query
        this.store$.pipe(select(selectMoveTableCursorDown))
      ).pipe(
        first(),
        mergeMap(([rows, documents, moveCursorDown]) &#x3D;&gt; {
          const {cursor} &#x3D; action.payload;

          const createdDocuments &#x3D; filterNewlyCreatedDocuments(rows, documents);
          const unknownDocuments &#x3D; filterUnknownDocuments(rows, documents);

          const actions: Action[] &#x3D; [];

          if (createdDocuments.length &gt; 0) {
            actions.push(
              new TablesAction.InitRows({
                cursor: {...cursor, rowPath: []},
                documents: createdDocuments,
                linkInstances: [],
              })
            );
            if (moveCursorDown) {
              actions.push(new TablesAction.MoveCursor({direction: Direction.Down}));
            }
          }

          const documentIds &#x3D; new Set(documents.map(doc &#x3D;&gt; doc.id));
          if (rows.some(row &#x3D;&gt; row.documentId &amp;&amp; !documentIds.has(row.documentId))) {
            actions.push(new TablesAction.CleanRows({cursor, documents, linkInstances: []}));
          }

          if (unknownDocuments.length &gt; 0) {
            actions.push(
              new TablesAction.AddPrimaryRows({
                cursor,
                rows: unknownDocuments.map(document &#x3D;&gt; createTableRow(document)),
                append: true,
              })
            );
          }

          return actions.concat(new TablesAction.OrderPrimaryRows({cursor, documents}));
        })
      )
    )
  )</code>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Decorators : </i><code>Effect</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="534" class="link-to-prism">src/app/core/store/tables/tables.effects.ts:534</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import {Injectable} from &#x27;@angular/core&#x27;;
import {Actions, Effect, ofType} from &#x27;@ngrx/effects&#x27;;
import {Action, select, Store} from &#x27;@ngrx/store&#x27;;
import {combineLatest, Observable, of} from &#x27;rxjs&#x27;;
import {
  concatMap,
  debounceTime,
  filter,
  first,
  flatMap,
  map,
  mergeMap,
  switchMap,
  withLatestFrom,
} from &#x27;rxjs/operators&#x27;;
import {Direction} from &#x27;../../../shared/direction&#x27;;
import {getArrayDifference} from &#x27;../../../shared/utils/array.utils&#x27;;
import {generateAttributeName} from &#x27;../../../shared/utils/attribute.utils&#x27;;
import {AppState} from &#x27;../app.state&#x27;;
import {AttributeModel, CollectionModel} from &#x27;../collections/collection.model&#x27;;
import {CollectionsAction} from &#x27;../collections/collections.action&#x27;;
import {selectAllCollections, selectCollectionById, selectCollectionsLoaded} from &#x27;../collections/collections.state&#x27;;
import {selectDocumentsByCustomQuery} from &#x27;../common/permissions.selectors&#x27;;
import {DocumentModel} from &#x27;../documents/document.model&#x27;;
import {DocumentsAction} from &#x27;../documents/documents.action&#x27;;
import {selectDocumentsByIds, selectDocumentsDictionary} from &#x27;../documents/documents.state&#x27;;
import {findLinkInstanceByDocumentId, getOtherDocumentIdFromLinkInstance} from &#x27;../link-instances/link-instance.utils&#x27;;
import {LinkInstancesAction} from &#x27;../link-instances/link-instances.action&#x27;;
import {selectLinkInstancesByTypeAndDocuments} from &#x27;../link-instances/link-instances.state&#x27;;
import {LinkTypeHelper} from &#x27;../link-types/link-type.helper&#x27;;
import {selectLinkTypeById} from &#x27;../link-types/link-types.state&#x27;;
import {selectQuery} from &#x27;../navigation/navigation.state&#x27;;
import {QueryConverter} from &#x27;../navigation/query.converter&#x27;;
import {QueryModel} from &#x27;../navigation/query.model&#x27;;
import {RouterAction} from &#x27;../router/router.action&#x27;;
import {ViewCursor} from &#x27;../views/view.model&#x27;;
import {ViewsAction} from &#x27;../views/views.action&#x27;;
import {moveTableCursor, TableBodyCursor, TableCursor} from &#x27;./table-cursor&#x27;;
import {convertTablePartsToConfig} from &#x27;./table.converter&#x27;;
import {
  DEFAULT_TABLE_ID,
  TableColumn,
  TableColumnType,
  TableCompoundColumn,
  TableConfigRow,
  TableHiddenColumn,
  TableModel,
  TablePart,
  TableSingleColumn,
} from &#x27;./table.model&#x27;;
import {
  createCollectionPart,
  createEmptyTableRow,
  createLinkPart,
  createTableColumnsBySiblingAttributeIds,
  createTableRow,
  extendHiddenColumn,
  findTableColumn,
  findTableRow,
  getAttributeIdFromColumn,
  mergeHiddenColumns,
  resizeLastColumnChild,
  splitColumnPath,
  splitRowPath,
} from &#x27;./table.utils&#x27;;
import {TablesAction, TablesActionType} from &#x27;./tables.action&#x27;;
import {selectTablePart, selectTableRow, selectTableRows, selectTableRowsWithHierarchyLevels} from &#x27;./tables.selector&#x27;;
import {selectMoveTableCursorDown, selectTableById, selectTableCursor} from &#x27;./tables.state&#x27;;

@Injectable()
export class TablesEffects {
  @Effect()
  public createTable$: Observable&lt;Action&gt; &#x3D; this.actions$.pipe(
    ofType&lt;TablesAction.CreateTable&gt;(TablesActionType.CREATE_TABLE),
    filter(action &#x3D;&gt; {
      const {query} &#x3D; action.payload;
      return query &amp;&amp; query.collectionIds &amp;&amp; query.collectionIds.length &#x3D;&#x3D;&#x3D; 1;
    }),
    withLatestFrom(
      this.store$.select(selectCollectionsLoaded).pipe(
        filter(loaded &#x3D;&gt; loaded),
        mergeMap(() &#x3D;&gt; this.store$.select(selectAllCollections))
      )
    ),
    flatMap(([action, collections]) &#x3D;&gt; {
      const {config, query} &#x3D; action.payload;

      const collection &#x3D; collections.find(col &#x3D;&gt; col.id &#x3D;&#x3D;&#x3D; query.collectionIds[0]);
      const last &#x3D; !query.linkTypeIds || query.linkTypeIds.length &#x3D;&#x3D;&#x3D; 0;
      const part &#x3D; createCollectionPart(collection, 0, last, config);

      const createTableAction: Action &#x3D; new TablesAction.AddTable({
        table: {
          id: action.payload.tableId,
          parts: [part],
          config: config || {
            parts: convertTablePartsToConfig([part]),
            rows: [createEmptyTableRow()],
          },
        },
      });

      const createPartActions: Action[] &#x3D; query.linkTypeIds.map(
        (linkTypeId, index) &#x3D;&gt;
          new TablesAction.CreatePart({
            tableId: action.payload.tableId,
            linkTypeId,
            last: index &#x3D;&#x3D;&#x3D; query.linkTypeIds.length - 1,
            config,
          })
      );

      return [createTableAction].concat(createPartActions);
    })
  );

  @Effect()
  public destroyTable$: Observable&lt;Action&gt; &#x3D; this.actions$.pipe(
    ofType&lt;TablesAction.DestroyTable&gt;(TablesActionType.DESTROY_TABLE),
    mergeMap(action &#x3D;&gt;
      combineLatest(
        this.store$.select(selectTableById(action.payload.tableId)),
        this.store$.select(selectTableCursor)
      ).pipe(first())
    ),
    filter(([table]) &#x3D;&gt; !!table),
    mergeMap(([table, tableCursor]) &#x3D;&gt; {
      if (tableCursor &amp;&amp; tableCursor.tableId &#x3D;&#x3D;&#x3D; table.id) {
        return this.createViewCursorFromTable(table, tableCursor).pipe(map(viewCursor &#x3D;&gt; ({table, viewCursor})));
      }
      return of({table, viewCursor: null});
    }),
    flatMap(({table, viewCursor}) &#x3D;&gt; {
      const actions: Action[] &#x3D; [new TablesAction.RemoveTable({tableId: table.id})];

      if (table.id &#x3D;&#x3D;&#x3D; DEFAULT_TABLE_ID) {
        actions.push(new ViewsAction.SetCursor({cursor: viewCursor}));
      }

      return actions;
    })
  );

  @Effect()
  public createPart$: Observable&lt;Action&gt; &#x3D; this.actions$.pipe(
    ofType&lt;TablesAction.CreatePart&gt;(TablesActionType.CREATE_PART),
    mergeMap(action &#x3D;&gt;
      this.store$.select(selectTableById(action.payload.tableId)).pipe(
        first(),
        filter(table &#x3D;&gt; !!table),
        map(table &#x3D;&gt; ({action, table}))
      )
    ),
    mergeMap(item &#x3D;&gt;
      this.store$.select(selectLinkTypeById(item.action.payload.linkTypeId)).pipe(
        first(),
        map(linkType &#x3D;&gt; ({...item, linkType}))
      )
    ),
    mergeMap(item &#x3D;&gt; {
      const parts &#x3D; item.table.parts;
      const lastPart &#x3D; parts[parts.length - 1];

      const collectionId &#x3D; LinkTypeHelper.getOtherCollectionId(item.linkType, lastPart.collectionId);
      return this.store$.select(selectCollectionById(collectionId)).pipe(
        first(),
        map(collection &#x3D;&gt; ({...item, collection}))
      );
    }),
    mergeMap(({action, table, linkType, collection}) &#x3D;&gt; {
      const lastPartIndex &#x3D; table.parts.length - 1;
      const linkTypePart &#x3D; createLinkPart(linkType, lastPartIndex + 1, action.payload.config);
      const collectionPart &#x3D; createCollectionPart(
        collection,
        lastPartIndex + 2,
        action.payload.last,
        action.payload.config
      );

      return [
        new TablesAction.RemoveEmptyColumns({
          cursor: {tableId: table.id, partIndex: lastPartIndex},
        }),
        new TablesAction.AddPart({
          tableId: table.id,
          parts: [linkTypePart, collectionPart],
        }),
        // TODO get data only in guards
        new DocumentsAction.Get({
          query: {
            collectionIds: [collection.id],
          },
        }),
        new LinkInstancesAction.Get({
          query: {
            linkTypeIds: [linkType.id],
          },
        }),
      ];
    })
  );

  @Effect()
  public switchParts$: Observable&lt;Action&gt; &#x3D; this.actions$.pipe(
    ofType&lt;TablesAction.SwitchParts&gt;(TablesActionType.SWITCH_PARTS),
    mergeMap(action &#x3D;&gt; this.getLatestTable(action)),
    filter(({action, table}) &#x3D;&gt; table.parts.length &#x3D;&#x3D;&#x3D; 3),
    withLatestFrom(this.store$.select(selectQuery)),
    map(([{action, table}, query]) &#x3D;&gt; {
      const linkTypeIds &#x3D; [table.parts[1].linkTypeId];
      const collectionIds &#x3D; [table.parts[2].collectionId];

      const newQuery: QueryModel &#x3D; {...query, collectionIds, linkTypeIds};

      return new RouterAction.Go({
        path: [],
        queryParams: {
          query: QueryConverter.toString(newQuery),
        },
        extras: {
          queryParamsHandling: &#x27;merge&#x27;,
        },
      });
    })
  );

  @Effect()
  public removePart$: Observable&lt;Action&gt; &#x3D; this.actions$.pipe(
    ofType&lt;TablesAction.RemovePart&gt;(TablesActionType.REMOVE_PART),
    mergeMap(action &#x3D;&gt; this.getLatestTable(action)),
    withLatestFrom(this.store$.select(selectQuery)),
    map(([{action, table}, query]) &#x3D;&gt; {
      const linkTypeIds &#x3D; table.parts
        .slice(0, action.payload.cursor.partIndex)
        .reduce((ids, part) &#x3D;&gt; (part.linkTypeId ? ids.concat(part.linkTypeId) : ids), []);
      const newQuery: QueryModel &#x3D; {...query, linkTypeIds};

      return new RouterAction.Go({
        path: [],
        queryParams: {
          query: QueryConverter.toString(newQuery),
        },
        extras: {
          queryParamsHandling: &#x27;merge&#x27;,
        },
      });
    })
  );

  @Effect()
  public addColumn$: Observable&lt;Action&gt; &#x3D; this.actions$.pipe(
    ofType&lt;TablesAction.AddColumn&gt;(TablesActionType.ADD_COLUMN),
    mergeMap(action &#x3D;&gt; this.getLatestTable(action)),
    mergeMap(({action, table}) &#x3D;&gt;
      this.createNewEmptyColumn(table, action.payload.cursor).pipe(
        map(
          column &#x3D;&gt;
            new TablesAction.ReplaceColumns({
              cursor: action.payload.cursor,
              deleteCount: 0,
              columns: [column],
            })
        )
      )
    )
  );

  private createNewEmptyColumn(table: TableModel, cursor: TableCursor): Observable&lt;TableCompoundColumn&gt; {
    const part: TablePart &#x3D; table.parts[cursor.partIndex];
    const columns &#x3D; part.columns;

    return this.getLatestAttributes(part).pipe(
      map(attributes &#x3D;&gt; {
        const parentColumn &#x3D;
          cursor.columnPath.length &gt; 1 ? findTableColumn(columns, cursor.columnPath.slice(0, -1)) : null;
        const parentAttributeId &#x3D; parentColumn ? (parentColumn as TableCompoundColumn).parent.attributeId : null;
        const parentAttribute &#x3D; attributes.find(attribute &#x3D;&gt; attribute.id &#x3D;&#x3D;&#x3D; parentAttributeId);
        const parentName &#x3D; parentAttribute ? parentAttribute.name : null;

        const attributeName &#x3D; generateAttributeName(attributes, parentName);
        return new TableCompoundColumn(new TableSingleColumn(null, attributeName), []);
      })
    );
  }

  private getLatestAttributes(part: TablePart): Observable&lt;AttributeModel[]&gt; {
    if (part.collectionId) {
      return this.store$.select(selectCollectionById(part.collectionId)).pipe(
        first(),
        map(collection &#x3D;&gt; collection.attributes)
      );
    } else {
      return this.store$.select(selectLinkTypeById(part.linkTypeId)).pipe(
        first(),
        map(linkType &#x3D;&gt; linkType.attributes)
      );
    }
  }

  @Effect()
  public splitColumn$: Observable&lt;Action&gt; &#x3D; this.actions$.pipe(
    ofType&lt;TablesAction.SplitColumn&gt;(TablesActionType.SPLIT_COLUMN),
    mergeMap(action &#x3D;&gt;
      this.store$.select(selectTableById(action.payload.cursor.tableId)).pipe(
        first(),
        mergeMap(table &#x3D;&gt; {
          const part &#x3D; table.parts[action.payload.cursor.partIndex];
          return this.store$.select(selectCollectionById(part.collectionId)).pipe(
            // TODO linktype as well
            first(),
            map(collection &#x3D;&gt; ({action, part, collection}))
          );
        })
      )
    ),
    flatMap(({action, part, collection}) &#x3D;&gt; {
      const childNames &#x3D; [&#x27;A&#x27;, &#x27;B&#x27;];

      const {cursor} &#x3D; action.payload;
      const column &#x3D; findTableColumn(part.columns, cursor.columnPath) as TableCompoundColumn;

      const oldAttribute &#x3D; collection.attributes.find(attribute &#x3D;&gt; attribute.id &#x3D;&#x3D;&#x3D; column.parent.attributeId);

      const replaceColumnAction &#x3D; createReplaceColumnAction(action, column, childNames);
      const parentAttributeAction &#x3D; createParentAttributeAction(collection, oldAttribute, replaceColumnAction);
      const secondChildAttributeAction &#x3D; createSecondChildAttributeAction(
        collection,
        oldAttribute,
        childNames[1],
        parentAttributeAction
      );
      const firstChildAttributeAction &#x3D; createFirstChildAttributeAction(
        collection,
        oldAttribute,
        childNames[0],
        secondChildAttributeAction
      );

      return [firstChildAttributeAction, new TablesAction.SetCursor({cursor: null})];
    })
  );

  @Effect()
  public hideColumn$: Observable&lt;Action&gt; &#x3D; this.actions$.pipe(
    ofType&lt;TablesAction.HideColumn&gt;(TablesActionType.HIDE_COLUMN),
    mergeMap(action &#x3D;&gt; this.getLatestTable(action)),
    mergeMap(({action, table}) &#x3D;&gt; {
      const {cursor} &#x3D; action.payload;
      const part: TablePart &#x3D; table.parts[cursor.partIndex];
      const {parentPath, columnIndex} &#x3D; splitColumnPath(cursor.columnPath);

      const column &#x3D; findTableColumn(part.columns, cursor.columnPath) as TableCompoundColumn;

      const pathBefore &#x3D; parentPath.concat(columnIndex - 1);
      const columnBefore &#x3D; columnIndex &gt; 0 ? findTableColumn(part.columns, pathBefore) : null;
      const hiddenBefore: boolean &#x3D; columnBefore &amp;&amp; columnBefore.type &#x3D;&#x3D;&#x3D; TableColumnType.HIDDEN;

      const columnAfter &#x3D; findTableColumn(part.columns, parentPath.concat(columnIndex + 1));
      const hiddenAfter: boolean &#x3D; columnAfter &amp;&amp; columnAfter.type &#x3D;&#x3D;&#x3D; TableColumnType.HIDDEN;

      const actions: Action[] &#x3D; [];

      if (hiddenBefore &amp;&amp; hiddenAfter) {
        const mergedColumn &#x3D; mergeHiddenColumns(columnBefore as TableHiddenColumn, columnAfter as TableHiddenColumn);
        actions.push(
          new TablesAction.ReplaceColumns({
            cursor: {...cursor, columnPath: pathBefore},
            deleteCount: 3,
            columns: [extendHiddenColumn(mergedColumn, column.parent.attributeId)],
          })
        );
      }
      if (hiddenBefore &amp;&amp; !hiddenAfter) {
        actions.push(
          new TablesAction.ReplaceColumns({
            cursor: {...cursor, columnPath: pathBefore},
            deleteCount: 2,
            columns: [extendHiddenColumn(columnBefore as TableHiddenColumn, column.parent.attributeId)],
          })
        );
      }
      if (!hiddenBefore &amp;&amp; hiddenAfter) {
        actions.push(
          new TablesAction.ReplaceColumns({
            cursor,
            deleteCount: 2,
            columns: [extendHiddenColumn(columnAfter as TableHiddenColumn, column.parent.attributeId)],
          })
        );
      }
      if (!hiddenBefore &amp;&amp; !hiddenAfter) {
        actions.push(
          new TablesAction.ReplaceColumns({
            cursor,
            deleteCount: 1,
            columns: [new TableHiddenColumn([column.parent.attributeId])],
          })
        );
      }

      return actions;
    })
  );

  @Effect()
  public showColumns$: Observable&lt;Action&gt; &#x3D; this.actions$.pipe(
    ofType&lt;TablesAction.ShowColumns&gt;(TablesActionType.SHOW_COLUMNS),
    mergeMap(action &#x3D;&gt; this.getLatestTable(action)),
    map(({action, table}) &#x3D;&gt; {
      const part: TablePart &#x3D; table.parts[action.payload.cursor.partIndex];
      return {action, part};
    }),
    mergeMap(({action, part}) &#x3D;&gt; {
      if (part.collectionId) {
        return this.store$.select(selectCollectionById(part.collectionId)).pipe(
          first(),
          map(collection &#x3D;&gt; ({action, part, attributes: collection.attributes}))
        );
      }
      if (part.linkTypeId) {
        return this.store$.select(selectLinkTypeById(part.linkTypeId)).pipe(
          first(),
          map(collection &#x3D;&gt; ({action, part, attributes: collection.attributes}))
        );
      }
    }),
    map(({action, part, attributes}) &#x3D;&gt; {
      const {cursor, attributeIds} &#x3D; action.payload;

      const hiddenColumn &#x3D; findTableColumn(part.columns, cursor.columnPath) as TableHiddenColumn;

      const columns &#x3D; createTableColumnsBySiblingAttributeIds(attributes, attributeIds);

      const hiddenAttributeIds &#x3D; getArrayDifference(hiddenColumn.attributeIds, attributeIds);
      if (hiddenAttributeIds.length &gt; 0) {
        const updatedHiddenColumn: TableHiddenColumn &#x3D; {...hiddenColumn, attributeIds: hiddenAttributeIds};
        columns.push(updatedHiddenColumn);
      }

      return new TablesAction.ReplaceColumns({
        cursor: action.payload.cursor,
        deleteCount: 1,
        columns,
      });
    })
  );

  @Effect()
  public removeColumn$: Observable&lt;Action&gt; &#x3D; this.actions$.pipe(
    ofType&lt;TablesAction.RemoveColumn&gt;(TablesActionType.REMOVE_COLUMN),
    mergeMap(action &#x3D;&gt;
      this.store$.select(selectTableById(action.payload.cursor.tableId)).pipe(
        first(),
        map(table &#x3D;&gt; ({action, table}))
      )
    ),
    flatMap(({action, table}) &#x3D;&gt; {
      const {cursor} &#x3D; action.payload;
      const part: TablePart &#x3D; table.parts[cursor.partIndex];
      const column &#x3D; findTableColumn(part.columns, cursor.columnPath);
      const attributeId &#x3D; getAttributeIdFromColumn(column);

      return [
        new TablesAction.ReplaceColumns({cursor, deleteCount: 1}),
        new CollectionsAction.RemoveAttribute({collectionId: part.collectionId, attributeId}),
      ];
    })
  );

  @Effect()
  public resizeColumn$: Observable&lt;Action&gt; &#x3D; this.actions$.pipe(
    ofType&lt;TablesAction.ResizeColumn&gt;(TablesActionType.RESIZE_COLUMN),
    mergeMap(action &#x3D;&gt; this.getLatestTable(action)),
    map(({action, table}) &#x3D;&gt; {
      const {cursor} &#x3D; action.payload;
      const part: TablePart &#x3D; table.parts[cursor.partIndex];
      const column &#x3D; findTableColumn(part.columns, cursor.columnPath) as TableCompoundColumn;
      const resizedColumn &#x3D; resizeLastColumnChild(column, action.payload.delta);

      return new TablesAction.ReplaceColumns({
        cursor,
        deleteCount: 1,
        columns: [resizedColumn],
      });
    })
  );

  @Effect()
  public initColumn$: Observable&lt;Action&gt; &#x3D; this.actions$.pipe(
    ofType&lt;TablesAction.InitColumn&gt;(TablesActionType.INIT_COLUMN),
    mergeMap(action &#x3D;&gt; this.getLatestTable(action)),
    mergeMap(({action, table}) &#x3D;&gt; {
      const part: TablePart &#x3D; table.parts[action.payload.cursor.partIndex];
      const column &#x3D; findTableColumn(part.columns, action.payload.cursor.columnPath) as TableCompoundColumn;
      const parent &#x3D; {...column.parent, attributeId: action.payload.attributeId};
      const columns &#x3D; [{...column, parent}];

      const {cursor} &#x3D; action.payload;
      const actions: Action[] &#x3D; [
        new TablesAction.ReplaceColumns({
          cursor,
          deleteCount: 1,
          columns,
        }),
      ];

      if (cursor.columnPath.length &#x3D;&#x3D;&#x3D; 1) {
        actions.push(new TablesAction.AddColumn({cursor: {...cursor, columnPath: [cursor.columnPath[0] + 1]}}));
      }

      return actions;
    })
  );

  @Effect()
  public syncPrimaryRows$: Observable&lt;Action&gt; &#x3D; this.actions$.pipe(
    ofType&lt;TablesAction.SyncPrimaryRows&gt;(TablesActionType.SYNC_PRIMARY_ROWS),
    debounceTime(100), // otherwise unwanted parallel syncing occurs
    switchMap(action &#x3D;&gt;
      combineLatest(
        this.store$.pipe(select(selectTableRows(action.payload.cursor.tableId))),
        this.store$.pipe(select(selectDocumentsByCustomQuery(action.payload.query, false, true))), // TODO maybe remove links from query
        this.store$.pipe(select(selectMoveTableCursorDown))
      ).pipe(
        first(),
        mergeMap(([rows, documents, moveCursorDown]) &#x3D;&gt; {
          const {cursor} &#x3D; action.payload;

          const createdDocuments &#x3D; filterNewlyCreatedDocuments(rows, documents);
          const unknownDocuments &#x3D; filterUnknownDocuments(rows, documents);

          const actions: Action[] &#x3D; [];

          if (createdDocuments.length &gt; 0) {
            actions.push(
              new TablesAction.InitRows({
                cursor: {...cursor, rowPath: []},
                documents: createdDocuments,
                linkInstances: [],
              })
            );
            if (moveCursorDown) {
              actions.push(new TablesAction.MoveCursor({direction: Direction.Down}));
            }
          }

          const documentIds &#x3D; new Set(documents.map(doc &#x3D;&gt; doc.id));
          if (rows.some(row &#x3D;&gt; row.documentId &amp;&amp; !documentIds.has(row.documentId))) {
            actions.push(new TablesAction.CleanRows({cursor, documents, linkInstances: []}));
          }

          if (unknownDocuments.length &gt; 0) {
            actions.push(
              new TablesAction.AddPrimaryRows({
                cursor,
                rows: unknownDocuments.map(document &#x3D;&gt; createTableRow(document)),
                append: true,
              })
            );
          }

          return actions.concat(new TablesAction.OrderPrimaryRows({cursor, documents}));
        })
      )
    )
  );

  @Effect()
  public syncLinkedRows$: Observable&lt;Action&gt; &#x3D; this.actions$.pipe(
    ofType&lt;TablesAction.SyncLinkedRows&gt;(TablesActionType.SYNC_LINKED_ROWS),
    mergeMap(action &#x3D;&gt;
      combineLatest(
        this.store$.pipe(select(selectTablePart(action.payload.cursor))),
        this.store$.pipe(select(selectTableRow(action.payload.cursor)))
      ).pipe(
        first(),
        filter(([part, row]) &#x3D;&gt; !!part &amp;&amp; !!row),
        mergeMap(([part, row]) &#x3D;&gt; {
          const linkedRows &#x3D; row.linkedRows || [];
          return this.store$.pipe(
            select(selectLinkInstancesByTypeAndDocuments(part.linkTypeId, [row.documentId])),
            first(),
            mergeMap(linkInstances &#x3D;&gt; {
              const documentIds &#x3D; linkInstances.reduce((ids, linkInstance) &#x3D;&gt; {
                const documentId &#x3D; getOtherDocumentIdFromLinkInstance(linkInstance, row.documentId);
                return ids.includes(documentId) ? ids : ids.concat(documentId);
              }, []);
              return this.store$.pipe(
                select(selectDocumentsByIds(documentIds)),
                first(),
                mergeMap(documents &#x3D;&gt; {
                  const createdDocuments &#x3D; filterNewlyCreatedDocuments(linkedRows, documents);
                  const unknownDocuments &#x3D; filterUnknownDocuments(linkedRows, documents);

                  const actions: Action[] &#x3D; [];

                  if (createdDocuments.length &gt; 0) {
                    actions.push(
                      new TablesAction.InitRows({
                        cursor: action.payload.cursor,
                        documents: createdDocuments,
                        linkInstances,
                      })
                    );
                  }

                  if (
                    unknownDocuments.length &gt; 0 &amp;&amp;
                    unknownDocuments.some(document &#x3D;&gt; !!findLinkInstanceByDocumentId(linkInstances, document.id))
                  ) {
                    actions.push(
                      new TablesAction.AddLinkedRows({
                        cursor: action.payload.cursor,
                        linkedRows: unknownDocuments.reduce((rows, document) &#x3D;&gt; {
                          const linkInstance &#x3D; findLinkInstanceByDocumentId(linkInstances, document.id);
                          return linkInstance ? rows.concat(createTableRow(document, linkInstance)) : rows;
                        }, []),
                        append: true,
                      })
                    );
                  }

                  return actions;
                })
              );
            })
          );
        })
      )
    )
  );

  @Effect()
  public indentRow$: Observable&lt;Action&gt; &#x3D; this.actions$.pipe(
    ofType&lt;TablesAction.IndentRow&gt;(TablesActionType.INDENT_ROW),
    map(action &#x3D;&gt; action.payload.cursor),
    filter(cursor &#x3D;&gt; cursor.partIndex &#x3D;&#x3D;&#x3D; 0 &amp;&amp; cursor.rowPath[0] &gt; 0),
    withLatestFrom(this.store$.pipe(select(selectDocumentsDictionary))),
    mergeMap(([cursor, documentsMap]) &#x3D;&gt;
      this.store$.pipe(
        select(selectTableRowsWithHierarchyLevels(cursor.tableId)),
        first(),
        map(rows &#x3D;&gt; {
          const rowIndex &#x3D; cursor.rowPath[0];
          const {row, level} &#x3D; rows[rowIndex];
          const {row: newParentRow &#x3D; undefined} &#x3D;
            rows
              .slice(0, cursor.rowPath[0])
              .reverse()
              .find(hierarchyRow &#x3D;&gt; hierarchyRow.level &#x3D;&#x3D;&#x3D; level) || {};
          const parentDocumentId &#x3D; newParentRow &amp;&amp; newParentRow.documentId;

          if (row.documentId) {
            const {collectionId, id: documentId} &#x3D; documentsMap[row.documentId];
            return new DocumentsAction.PatchMetaData({
              collectionId,
              documentId,
              metaData: {parentId: parentDocumentId},
            });
          } else {
            const updatedRow: TableConfigRow &#x3D; {...row, parentDocumentId};
            return new TablesAction.ReplaceRows({cursor, deleteCount: 1, rows: [updatedRow]});
          }
        })
      )
    )
  );

  @Effect()
  public outdentRow$: Observable&lt;Action&gt; &#x3D; this.actions$.pipe(
    ofType&lt;TablesAction.OutdentRow&gt;(TablesActionType.OUTDENT_ROW),
    map(action &#x3D;&gt; action.payload.cursor),
    filter(cursor &#x3D;&gt; cursor.partIndex &#x3D;&#x3D;&#x3D; 0),
    withLatestFrom(this.store$.pipe(select(selectDocumentsDictionary))),
    mergeMap(([cursor, documentsMap]) &#x3D;&gt;
      this.store$.pipe(
        select(selectTableRowsWithHierarchyLevels(cursor.tableId)),
        first(),
        map(rows &#x3D;&gt; {
          const rowIndex &#x3D; cursor.rowPath[0];
          const {row, level} &#x3D; rows[rowIndex];
          const {row: previousParentRow &#x3D; undefined} &#x3D;
            rows
              .slice(0, cursor.rowPath[0])
              .reverse()
              .find(hierarchyRow &#x3D;&gt; hierarchyRow.level &#x3D;&#x3D;&#x3D; level - 1) || {};
          const previousParentDocument &#x3D; documentsMap[previousParentRow &amp;&amp; previousParentRow.documentId];
          const parentDocumentId &#x3D;
            (previousParentDocument &amp;&amp; previousParentDocument.metaData &amp;&amp; previousParentDocument.metaData.parentId) ||
            null;

          if (row.documentId) {
            const {collectionId, id: documentId} &#x3D; documentsMap[row.documentId];
            return new DocumentsAction.PatchMetaData({
              collectionId,
              documentId,
              metaData: {parentId: parentDocumentId},
            });
          } else {
            const updatedRow: TableConfigRow &#x3D; {...row, parentDocumentId};
            return new TablesAction.ReplaceRows({cursor, deleteCount: 1, rows: [updatedRow]});
          }
        })
      )
    )
  );

  @Effect()
  public moveRowUp$: Observable&lt;Action&gt; &#x3D; this.actions$.pipe(
    ofType&lt;TablesAction.MoveRowUp&gt;(TablesActionType.MOVE_ROW_UP),
    mergeMap(action &#x3D;&gt; {
      const {cursor} &#x3D; action.payload;
      const {parentPath, rowIndex} &#x3D; splitRowPath(cursor.rowPath);
      if (rowIndex &#x3D;&#x3D;&#x3D; 0) {
        return [];
      }

      return combineLatest(
        this.store$.pipe(select(selectTableRows(cursor.tableId))),
        this.store$.pipe(select(selectDocumentsDictionary))
      ).pipe(
        first(),
        mergeMap(([rows, documentsMap]) &#x3D;&gt; {
          const row &#x3D; findTableRow(rows, cursor.rowPath);
          const document &#x3D; documentsMap[row &amp;&amp; row.documentId];
          const parentId &#x3D;
            (document &amp;&amp; document.metaData &amp;&amp; document.metaData.parentId) || (row &amp;&amp; row.parentDocumentId) || null;

          const previousCursor: TableBodyCursor &#x3D; {...cursor, rowPath: parentPath.concat(rowIndex - 1)};
          const previousRow &#x3D; findTableRow(rows, previousCursor.rowPath);
          const previousDocument &#x3D; documentsMap[previousRow &amp;&amp; previousRow.documentId];
          const previousParentId &#x3D;
            (previousDocument &amp;&amp; previousDocument.metaData &amp;&amp; previousDocument.metaData.parentId) ||
            (previousRow &amp;&amp; previousRow.parentDocumentId) ||
            null;

          const actions: Action[] &#x3D; [
            new TablesAction.RemoveRow({cursor}),
            new TablesAction.ReplaceRows({cursor: previousCursor, rows: [row], deleteCount: 0}),
          ];

          if (cursor.partIndex &#x3D;&#x3D;&#x3D; 0 &amp;&amp; parentId !&#x3D;&#x3D; previousParentId) {
            if (row.documentId) {
              return [
                new DocumentsAction.PatchMetaData({
                  collectionId: document.collectionId,
                  documentId: document.id,
                  metaData: {parentId: previousParentId},
                  onSuccess: () &#x3D;&gt; actions.forEach(a &#x3D;&gt; this.store$.dispatch(a)),
                }),
              ];
            } else {
              return [
                new TablesAction.RemoveRow({cursor}),
                new TablesAction.ReplaceRows({
                  cursor: previousCursor,
                  rows: [{...row, parentDocumentId: previousParentId}],
                  deleteCount: 0,
                }),
              ];
            }
          }

          return actions;
        })
      );
    })
  );

  @Effect()
  public moveRowDown$: Observable&lt;Action&gt; &#x3D; this.actions$.pipe(
    ofType&lt;TablesAction.MoveRowDown&gt;(TablesActionType.MOVE_ROW_DOWN),
    mergeMap(action &#x3D;&gt; {
      const {cursor} &#x3D; action.payload;
      const {parentPath, rowIndex} &#x3D; splitRowPath(cursor.rowPath);

      return combineLatest(
        this.store$.pipe(select(selectTableRows(cursor.tableId))),
        this.store$.pipe(select(selectTableRowsWithHierarchyLevels(cursor.tableId))),
        this.store$.pipe(select(selectDocumentsDictionary))
      ).pipe(
        first(),
        mergeMap(([rows, hierarchyRows, documentsMap]) &#x3D;&gt; {
          if (cursor.partIndex &gt; 0) {
            const row &#x3D; findTableRow(rows, cursor.rowPath);
            const nextLinkedCursor: TableBodyCursor &#x3D; {...cursor, rowPath: parentPath.concat(rowIndex + 1)};
            const nextLinkedRow &#x3D; findTableRow(rows, nextLinkedCursor.rowPath);
            if (!nextLinkedRow) {
              return [];
            }

            const targetLinkedCursor: TableBodyCursor &#x3D; {...cursor, rowPath: parentPath.concat(rowIndex + 2)};

            return [
              new TablesAction.ReplaceRows({cursor: targetLinkedCursor, rows: [row], deleteCount: 0}),
              new TablesAction.RemoveRow({cursor}),
            ];
          }

          const sourceRow &#x3D; hierarchyRows[cursor.rowPath[0]];
          const document &#x3D; documentsMap[sourceRow &amp;&amp; sourceRow.row.documentId];
          const parentId &#x3D;
            (document &amp;&amp; document.metaData &amp;&amp; document.metaData.parentId) ||
            (sourceRow &amp;&amp; sourceRow.row.parentDocumentId) ||
            null;

          const nextRow &#x3D; hierarchyRows.slice(rowIndex + 1).find(row &#x3D;&gt; row.level &lt;&#x3D; sourceRow.level);
          if (!nextRow) {
            return [];
          }

          const targetRowIndex &#x3D; hierarchyRows.indexOf(nextRow) + 1;
          const targetRow &#x3D; hierarchyRows[targetRowIndex];
          const targetCursor: TableBodyCursor &#x3D; {...cursor, rowPath: [targetRowIndex]};
          const targetDocument &#x3D; documentsMap[targetRow &amp;&amp; targetRow.row.documentId];
          const targetParentId &#x3D;
            (targetDocument &amp;&amp; targetDocument.metaData &amp;&amp; targetDocument.metaData.parentId) ||
            (targetRow &amp;&amp; targetRow.row.parentDocumentId) ||
            null;

          const deleteCount &#x3D; targetRowIndex - rowIndex - 1;
          const childRows &#x3D; rows.slice(rowIndex + 1, rowIndex + deleteCount);

          const actions: Action[] &#x3D; [
            new TablesAction.ReplaceRows({cursor: targetCursor, rows: [sourceRow.row, ...childRows], deleteCount: 0}),
            new TablesAction.ReplaceRows({cursor, rows: [], deleteCount}),
          ];

          if (parentId !&#x3D;&#x3D; targetParentId) {
            if (sourceRow.row.documentId) {
              return [
                new DocumentsAction.PatchMetaData({
                  collectionId: document.collectionId,
                  documentId: document.id,
                  metaData: {parentId: targetParentId},
                  onSuccess: () &#x3D;&gt; actions.forEach(a &#x3D;&gt; this.store$.dispatch(a)),
                }),
              ];
            } else {
              return [
                new TablesAction.ReplaceRows({
                  cursor: targetCursor,
                  rows: [{...sourceRow.row, parentDocumentId: targetParentId}, ...childRows],
                  deleteCount: 0,
                }),
                new TablesAction.ReplaceRows({cursor, rows: [], deleteCount}),
              ];
            }
          }

          return actions;
        })
      );
    })
  );

  @Effect()
  public moveCursor$: Observable&lt;Action&gt; &#x3D; this.actions$.pipe(
    ofType&lt;TablesAction.MoveCursor&gt;(TablesActionType.MOVE_CURSOR),
    withLatestFrom(this.store$.select(selectTableCursor).pipe(filter(cursor &#x3D;&gt; !!cursor))),
    concatMap(([action, cursor]) &#x3D;&gt;
      this.store$.select(selectTableById(cursor.tableId)).pipe(
        first(),
        map(table &#x3D;&gt; ({action, cursor, table}))
      )
    ),
    mergeMap(({action, cursor, table}) &#x3D;&gt; {
      try {
        const nextCursor &#x3D; moveTableCursor(table, cursor, action.payload.direction);
        return [new TablesAction.SetCursor({cursor: nextCursor})];
      } catch (error) {
        return [];
      }
    })
  );

  public constructor(private actions$: Actions, private store$: Store&lt;AppState&gt;) {}

  private getLatestTable&lt;A extends TablesAction.TableCursorAction&gt;(
    action: A
  ): Observable&lt;{action: A; table: TableModel}&gt; {
    return this.store$.select(selectTableById(action.payload.cursor.tableId)).pipe(
      first(),
      filter(table &#x3D;&gt; !!table),
      map(table &#x3D;&gt; ({action, table}))
    );
  }

  private createViewCursorFromTable(table: TableModel, cursor: TableCursor): Observable&lt;ViewCursor&gt; {
    if (!cursor || !cursor.rowPath) {
      return of(null);
    }

    const part &#x3D; table.parts[cursor.partIndex];
    if (!part || !part.collectionId) {
      return of(null);
    }

    const column &#x3D; part.columns[cursor.columnIndex];
    if (column.type !&#x3D;&#x3D; TableColumnType.COMPOUND) {
      return of(null);
    }

    const {attributeId} &#x3D; (column as TableCompoundColumn).parent;
    const row &#x3D; findTableRow(table.config.rows, cursor.rowPath);
    if (!row || !row.documentId) {
      return of(null);
    }

    if (cursor.rowPath.length &gt; 1) {
      const linkedRow &#x3D; findTableRow(table.config.rows, cursor.rowPath);
      const {linkTypeId} &#x3D; table.parts[cursor.partIndex - 1];
      const linkedDocumentId &#x3D; linkedRow.documentId;
      return this.store$.select(selectLinkInstancesByTypeAndDocuments(linkTypeId, [linkedDocumentId])).pipe(
        first(),
        map(linkInstances &#x3D;&gt; ({
          linkInstanceId: linkInstances.length ? linkInstances[0].id : null,
          collectionId: part.collectionId,
          documentId: row.documentId,
          attributeId,
        }))
      );
    }

    return of({
      collectionId: part.collectionId,
      documentId: row.documentId,
      attributeId,
    });
  }
}

function createReplaceColumnAction(
  splitAction: TablesAction.SplitColumn,
  oldColumn: TableCompoundColumn,
  childNames: string[]
): TablesAction.ReplaceColumns {
  const parent &#x3D; oldColumn.parent;
  const children: TableColumn[] &#x3D; childNames.map(name &#x3D;&gt; {
    return new TableCompoundColumn(new TableSingleColumn(&#x60;${parent.attributeId}.${name}&#x60;), []); // TODO fix attribute ID
  });
  const column: TableCompoundColumn &#x3D; new TableCompoundColumn(parent, children);

  return new TablesAction.ReplaceColumns({cursor: splitAction.payload.cursor, deleteCount: 1, columns: [column]});
}

function createParentAttributeAction(
  collection: CollectionModel,
  oldAttribute: AttributeModel,
  nextAction: TablesAction.ReplaceColumns
): CollectionsAction.ChangeAttribute {
  return new CollectionsAction.ChangeAttribute({
    collectionId: collection.id,
    attributeId: oldAttribute.id,
    attribute: {
      id: oldAttribute.id,
      name: oldAttribute.name,
      constraints: [],
    },
    nextAction,
  });
}

function createSecondChildAttributeAction(
  collection: CollectionModel,
  oldAttribute: AttributeModel,
  name: string,
  nextAction: CollectionsAction.ChangeAttribute
): CollectionsAction.ChangeAttribute {
  return new CollectionsAction.ChangeAttribute({
    collectionId: collection.id,
    attributeId: &#x60;${oldAttribute.id}.${name}&#x60;,
    attribute: {
      id: &#x60;${oldAttribute.id}.${name}&#x60;,
      name,
      constraints: [],
    },
    nextAction,
  });
}

function createFirstChildAttributeAction(
  collection: CollectionModel,
  oldAttribute: AttributeModel,
  name: string,
  nextAction: CollectionsAction.ChangeAttribute
): CollectionsAction.ChangeAttribute {
  return new CollectionsAction.ChangeAttribute({
    collectionId: collection.id,
    attributeId: &#x60;${oldAttribute.id}.${name}&#x60;,
    attribute: {...oldAttribute, id: &#x60;${oldAttribute.id}.${name}&#x60;, name},
    nextAction,
  });
}

function filterNewlyCreatedDocuments(rows: TableConfigRow[], documents: DocumentModel[]): DocumentModel[] {
  const rowCorrelationIds &#x3D; rows.filter(row &#x3D;&gt; row.correlationId &amp;&amp; !row.documentId).map(row &#x3D;&gt; row.correlationId);
  return documents
    .filter(document &#x3D;&gt; !!document.id &amp;&amp; !!document.correlationId)
    .filter(document &#x3D;&gt; rowCorrelationIds.includes(document.correlationId));
}

function filterUnknownDocuments(rows: TableConfigRow[], documents: DocumentModel[]): DocumentModel[] {
  return documents.filter(
    document &#x3D;&gt;
      !rows.some(row &#x3D;&gt; {
        return row.documentId &#x3D;&#x3D;&#x3D; document.id || (row.correlationId &amp;&amp; row.correlationId &#x3D;&#x3D;&#x3D; document.correlationId);
      })
  );
}
</code></pre>
    </div>

</div>











                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'TablesEffects.html';
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <script src="../js/menu-wc.js"></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
